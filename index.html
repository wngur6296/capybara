<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê°•í•´ì ¸ë°”ë¼ V2</title>
<style>
body{margin:0;background:#111;color:#fff;font-family:sans-serif;text-align:center}
.card{background:#1c1c24;margin:10px;padding:10px;border-radius:12px}
button{padding:12px;margin:6px;width:90%;border:0;border-radius:10px;font-weight:bold}
.hpbar{height:12px;background:#333;border-radius:8px;overflow:hidden;margin:4px}
.fill{height:100%;background:#44ff6a}
.mfill{background:#ff5555}
.hidden{display:none}
</style>
</head>
<body>

<h2>ê°•í•´ì ¸ë°”ë¼ V2</h2>

<div class="card">
ë ˆë²¨ <span id="lv">1</span> |
ìŠ¤í…Œì´ì§€ <span id="stage">1</span> |
ì§€ì—­ <span id="zone">ì´ˆì›</span>
<br>
HP <span id="hp"></span>/<span id="maxhp"></span>
<div class="hpbar"><div id="hpbar" class="fill"></div></div>
</div>

<div class="card">
ëª¬ìŠ¤í„°: <span id="mname"></span><br>
HP <span id="mhp"></span>/<span id="mmaxhp"></span>
<div class="hpbar"><div id="mhpbar" class="fill mfill"></div></div>
</div>

<div class="card">
<button onclick="attack()">âš” ê³µê²©</button>
<button onclick="heal()">ğŸ– íšŒë³µ</button>
</div>

<div class="card hidden" id="shopScreen">
ìƒì ì€ PART2ì—ì„œ í™œì„±í™”ë¨
</div>

<script>

const ZONES = [
{n:"ì´ˆì›", mobs:["ìŠ¬ë¼ì„","í† ë¼","ë“¤ê°œ"], boss:"ì´ˆì› ë“œë˜ê³¤"},
{n:"ìˆ²", mobs:["ëŠ‘ëŒ€","ë‚˜ë¬´ì •ë ¹","ê±°ëŒ€ë²„ì„¯"], boss:"ìˆ²ì˜ ìˆ˜í˜¸ì"},
{n:"ì‚¬ë§‰", mobs:["ì „ê°ˆ","ë¯¸ë¼","ëª¨ë˜ì •ë ¹"], boss:"ì‚¬ë§‰ì˜ êµ°ì£¼"},
{n:"ì„¤ì›", mobs:["ì„¤ì¸","ì–¼ìŒëŠ‘ëŒ€","ë¹™ì •ë ¹"], boss:"ì–¼ìŒ ìš©"},
{n:"í™”ì‚°", mobs:["ë¶ˆë„ë§ˆë±€","ë§ˆê·¸ë§ˆê´´ë¬¼","í™”ì—¼ì •ë ¹"], boss:"í™”ì—¼ êµ°ì£¼"},
{n:"ì‹¬ì—°", mobs:["ê·¸ë¦¼ì","ì‚¬ì‹ ","ë§ë ¹"], boss:"ì‹¬ì—°ì˜ ì™•"},
{n:"ì²œê³µ", mobs:["ì²œì‚¬ë³‘","ë²ˆê°œì •ë ¹","í•˜í”¼"], boss:"ì²œê³µ ìˆ˜í˜¸ì‹ "},
{n:"ì¢…ë§", mobs:["ì•…ë§ˆ","íƒ€ë½ê¸°ì‚¬","ê³µí—ˆê´´ìˆ˜"], boss:"ì¢…ë§ì˜ êµ°ì£¼"}
];

let state={
lv:1, exp:0, need:20,
stage:1,
hp:100, maxhp:100,
gold:0,
monster:null
};

function zoneIndex(){ return Math.floor((state.stage-1)/20); }

function spawn(){
let z=ZONES[zoneIndex()];
let boss=(state.stage%10===0);
let name=boss?z.boss:z.mobs[Math.floor(Math.random()*z.mobs.length)];
let hp=60+state.stage*8;
if(boss) hp*=3;
state.monster={name,hp,maxhp:hp,atk:6+state.stage};
}

function attack(){
if(state.hp<=0) return;
let dmg=5+state.lv*2;
state.monster.hp-=dmg;

if(state.monster.hp<=0){
win();
return;
}

let md=state.monster.atk;
md=Math.min(md,Math.floor(state.hp*0.95));
state.hp-=md;

render();
}

function win(){
let boss=(state.stage%10===0);
let exp=10+state.stage*3;
let gold=8+state.stage*2;
if(boss){exp*=2;gold*=3;}
state.exp+=exp;
state.gold+=gold;

while(state.exp>=state.need){
state.exp-=state.need;
state.lv++;
state.need=Math.floor(state.need*1.12+10);
state.maxhp+=15;
state.hp=state.maxhp;
}

state.stage++;
spawn();
render();
}

function heal(){
let h=Math.floor(state.maxhp*0.3);
state.hp=Math.min(state.hp+h,state.maxhp);
render();
}

function render(){
let z=ZONES[zoneIndex()];
document.getElementById("lv").textContent=state.lv;
document.getElementById("stage").textContent=state.stage;
document.getElementById("zone").textContent=z.n;
document.getElementById("hp").textContent=state.hp;
document.getElementById("maxhp").textContent=state.maxhp;
document.getElementById("hpbar").style.width=(state.hp/state.maxhp*100)+"%";

document.getElementById("mname").textContent=state.monster.name;
document.getElementById("mhp").textContent=state.monster.hp;
document.getElementById("mmaxhp").textContent=state.monster.maxhp;
document.getElementById("mhpbar").style.width=(state.monster.hp/state.monster.maxhp*100)+"%";
}

spawn();
render();
/* =========================
   PART 2 - ìƒì  & ê²½ì œ í™•ì¥
========================= */

state.dia = 10;
state.healItems = 0;

function openShop(){
document.getElementById("shopScreen").classList.remove("hidden");
renderShop();
}

function closeShop(){
document.getElementById("shopScreen").classList.add("hidden");
}

function renderShop(){
let s=document.getElementById("shopScreen");
s.innerHTML=`
<div class="card">
<h3>ìƒì </h3>
ê³¨ë“œ: ${state.gold} | ë‹¤ì´ì•„: ${state.dia}<br><br>

<button onclick="buyHealGacha(1)">ğŸ§´ íšŒë³µê°€ì±  1íšŒ (1000G)</button>
<button onclick="buyHealGacha(10)">ğŸ§´ íšŒë³µê°€ì±  10íšŒ (10000G)</button>

<button onclick="buyGear()">ğŸ° ì¥ë¹„ê°€ì±  (200G)</button>
<button onclick="buyCos()">âœ¨ ì¹˜ì¥ê°€ì±  (5ë‹¤ì´ì•„)</button>

<button onclick="claimDaily()">ğŸ“… ì¶œì„ë³´ìƒ</button>

<button onclick="closeShop()">ë‹«ê¸°</button>
</div>
`;
}

/* ------------------ íšŒë³µ ê°€ì±  ------------------ */
function buyHealGacha(n){
let cost=1000*n;
if(state.gold<cost) return alert("ê³¨ë“œ ë¶€ì¡±");
state.gold-=cost;
let total=0;
for(let i=0;i<n;i++){
total+=Math.floor(Math.random()*5)+3;
}
state.healItems+=total;
alert("íšŒë³µí…œ "+total+"ê°œ íšë“!");
renderShop();
}

/* ------------------ ì¥ë¹„ ê°€ì±  ------------------ */
function buyGear(){
if(state.gold<200) return alert("ê³¨ë“œ ë¶€ì¡±");
state.gold-=200;
alert("ì¥ë¹„ íšë“! (PART3ì—ì„œ ì¸ë²¤ ì¶”ê°€)");
renderShop();
}

/* ------------------ ì¹˜ì¥ ê°€ì±  ------------------ */
function buyCos(){
if(state.dia<5) return alert("ë‹¤ì´ì•„ ë¶€ì¡±");
state.dia-=5;
alert("ì¹˜ì¥ íšë“! (PART3ì—ì„œ ì¸ë²¤ ì¶”ê°€)");
renderShop();
}

/* ------------------ ì¶œì„ ì‹œìŠ¤í…œ ------------------ */
let daily=JSON.parse(localStorage.getItem("dailyV2")||"{}");

function today(){
let d=new Date();
return d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
}

function claimDaily(){
if(daily.last===today()) return alert("ì˜¤ëŠ˜ ì´ë¯¸ ë°›ìŒ");

daily.last=today();
daily.count=(daily.count||0)+1;
if(daily.count>7) daily.count=1;

let reward=5+daily.count*3;
state.dia+=reward;

localStorage.setItem("dailyV2",JSON.stringify(daily));
alert("ì¶œì„ "+daily.count+"ì¼ì°¨ ğŸ’"+reward);
renderShop();
}

/* ------------------ UI ë²„íŠ¼ ì¶”ê°€ ------------------ */
let battleCard=document.querySelectorAll(".card")[0];
battleCard.innerHTML+=`<br><button onclick="openShop()">ğŸ›’ ìƒì </button>`;

</script>
</body>
</html>
